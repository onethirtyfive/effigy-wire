#!/usr/bin/env ruby

LIB_ROOT =
  begin
    ENV.fetch('LIB_ROOT')
  rescue KeyError
    File.join(Dir.pwd, 'lib')
  end

Dir.glob(File.join(LIB_ROOT, '**/*')).each do |rb_path|
  next if File.directory?(rb_path)

  puts "> Tweaking #{File.basename(rb_path)}"
  cmd = <<-EOV
    sed -i \
        -e '/require ''.*..pb''/ s/require/require_relative/' \
        #{rb_path}
  EOV
  system(cmd)
end
